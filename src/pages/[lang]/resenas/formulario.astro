---
export const prerender = false;
import Layout from "../../../layouts/Layout.astro";

const { lang } = Astro.params;
const token = Astro.url.searchParams.get("token");

if (!token) {
  throw new Error("Token is required");
}

const texts = {
  es: {
    title: "Tu opini√≥n nos ayuda a mejorar",
    subtitle: "Gracias por confiar en BelgoTours. Tu rese√±a ayudar√° a otros viajeros a elegir con confianza.",
    general: "Valoraci√≥n general",
    tap: "Selecciona una valoraci√≥n",
    details: "Detalles de la experiencia",

    professionalism: "Profesionalidad del gu√≠a",
    fun: "Diversi√≥n",
    communication: "Comunicaci√≥n",
    quality: "Calidad de la informaci√≥n",
    route: "Ruta e itinerario",

    publicCommentTitle: "Cu√©ntanos tu experiencia",
    publicCommentDescription: "Comparte qu√© fue lo que m√°s disfrutaste del tour.",
    publicCommentPlaceholder: "Describe tu experiencia (m√≠nimo 20 caracteres)...",
    minCharacters: "M√≠nimo 20 caracteres.",
    submitReview: "Enviar rese√±a",
    reviewVisibility: "Tu rese√±a podr√° aparecer p√∫blicamente tras ser revisada."
  },

  en: {
    title: "Your opinion helps us improve",
    subtitle: "Thank you for choosing BelgoTours. Your review helps other travelers decide with confidence.",
    general: "Overall rating",
    tap: "Select your rating",
    details: "Experience details",

    professionalism: "Guide professionalism",
    fun: "Fun factor",
    communication: "Communication",
    quality: "Quality of information",
    route: "Route & itinerary",

    publicCommentTitle: "Tell us about your experience",
    publicCommentDescription: "Share what you enjoyed most about the tour.",
    publicCommentPlaceholder: "Describe your experience (minimum 20 characters)...",
    minCharacters: "Minimum 20 characters.",
    submitReview: "Submit review",
    reviewVisibility: "Your review may appear publicly after moderation."
  },

  it: {
    title: "La tua opinione ci aiuta a migliorare",
    subtitle: "Grazie per aver scelto BelgoTours.",
    general: "Valutazione generale",
    tap: "Seleziona una valutazione",
    details: "Dettagli dell‚Äôesperienza",

    professionalism: "Professionalit√† della guida",
    fun: "Divertimento",
    communication: "Comunicazione",
    quality: "Qualit√† delle informazioni",
    route: "Percorso e itinerario",

    publicCommentTitle: "Raccontaci la tua esperienza",
    publicCommentDescription: "Condividi ci√≤ che ti √® piaciuto di pi√π.",
    publicCommentPlaceholder: "Descrivi la tua esperienza (minimo 20 caratteri)...",
    minCharacters: "Minimo 20 caratteri.",
    submitReview: "Invia recensione",
    reviewVisibility: "La tua recensione potr√† essere pubblicata dopo moderazione."
  },

  fr: {
    title: "Votre avis nous aide √† nous am√©liorer",
    subtitle: "Merci d‚Äôavoir choisi BelgoTours.",
    general: "√âvaluation g√©n√©rale",
    tap: "S√©lectionnez une note",
    details: "D√©tails de l‚Äôexp√©rience",

    professionalism: "Professionnalisme du guide",
    fun: "Aspect divertissant",
    communication: "Communication",
    quality: "Qualit√© des informations",
    route: "Parcours et itin√©raire",

    publicCommentTitle: "Partagez votre exp√©rience",
    publicCommentDescription: "Partagez ce que vous avez le plus appr√©ci√©.",
    publicCommentPlaceholder: "D√©crivez votre exp√©rience (minimum 20 caract√®res)...",
    minCharacters: "Minimum 20 caract√®res.",
    submitReview: "Envoyer l‚Äôavis",
    reviewVisibility: "Votre avis pourra √™tre publi√© apr√®s validation."
  }
};

const t = texts[lang] || texts.es;
---

<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <title>{t.general} | BelgoTours</title>
  </head>

  <body class="bg-gray-100 text-gray-800">
    <Layout>
      <div class="max-w-3xl mx-auto bg-white shadow-xl rounded-3xl p-8 sm:p-12 mt-10 mb-24">

        <!-- TITULAR -->
        <h1 class="text-3xl sm:text-4xl font-semibold text-center mb-3">
          {t.title}
        </h1>

        <p class="text-center text-gray-500 mb-10 text-sm sm:text-base max-w-xl mx-auto">
          {t.subtitle}
        </p>

        <!-- FORMULARIO -->
        <form
          method="POST"
          action="/api/submit-review"
          class="space-y-10"
        >
          <input type="hidden" name="token" value={token} />

          <!-- ‚≠ê VALORACI√ìN GENERAL -->
          <section>

            <h2 class="text-lg font-semibold mb-4">
              {t.general}
            </h2>

            <div class="flex justify-center gap-3">

              {[1,2,3,4,5].map((value) => (
                <label class="cursor-pointer">
                  <input
                    type="radio"
                    name="rating_general"
                    value={value}
                    class="hidden peer"
                    required
                  />

                  <svg
                    viewBox="0 0 24 24"
                    class="w-12 h-12 transition-all duration-200
                           text-gray-300
                           hover:text-yellow-400
                           peer-checked:text-yellow-400
                           hover:scale-110"
                    fill="currentColor"
                  >
                    <path d="M12 17.27L18.18 21l-1.64-7.03
                             L22 9.24l-7.19-.61L12 2
                             9.19 8.63 2 9.24l5.46 4.73
                             L5.82 21z"/>
                  </svg>
                </label>
              ))}

            </div>

            <!-- Feedback din√°mico -->
            <p id="ratingText" class="text-center text-sm text-gray-500 mt-4"></p>

          </section>
          <!-- ‚≠ê SUBVALORACIONES -->
<section class="pt-6 border-t border-gray-200">

  <h2 class="text-lg font-semibold mb-6 text-center">
    {t.details}
  </h2>

  <div class="grid gap-8 sm:grid-cols-2">

    {/* ---------- Profesionalidad ---------- */}
    <div>
      <p class="font-medium mb-3">
        {t.professionalism}
      </p>

      <div class="flex justify-start gap-2">
        {[1,2,3,4,5].map((value) => (
          <label class="cursor-pointer">
            <input
              type="radio"
              name="profesionalidad"
              value={value}
              class="hidden peer"
            />
            <svg
              viewBox="0 0 24 24"
              class="w-8 h-8 sm:w-9 sm:h-9
                     text-gray-300
                     hover:text-yellow-400
                     peer-checked:text-yellow-400
                     transition-all duration-200
                     hover:scale-110"
              fill="currentColor"
            >
              <path d="M12 17.27L18.18 21l-1.64-7.03
                       L22 9.24l-7.19-.61L12 2
                       9.19 8.63 2 9.24l5.46 4.73
                       L5.82 21z"/>
            </svg>
          </label>
        ))}
      </div>
    </div>

    {/* ---------- Diversi√≥n ---------- */}
    <div>
      <p class="font-medium mb-3">
        {t.fun}
      </p>

      <div class="flex justify-start gap-2">
        {[1,2,3,4,5].map((value) => (
          <label class="cursor-pointer">
            <input
              type="radio"
              name="diversion"
              value={value}
              class="hidden peer"
            />
            <svg
              viewBox="0 0 24 24"
              class="w-8 h-8 sm:w-9 sm:h-9
                     text-gray-300
                     hover:text-yellow-400
                     peer-checked:text-yellow-400
                     transition-all duration-200
                     hover:scale-110"
              fill="currentColor"
            >
              <path d="M12 17.27L18.18 21l-1.64-7.03
                       L22 9.24l-7.19-.61L12 2
                       9.19 8.63 2 9.24l5.46 4.73
                       L5.82 21z"/>
            </svg>
          </label>
        ))}
      </div>
    </div>

    {/* ---------- Comunicaci√≥n ---------- */}
    <div>
      <p class="font-medium mb-3">
        {t.communication}
      </p>

      <div class="flex justify-start gap-2">
        {[1,2,3,4,5].map((value) => (
          <label class="cursor-pointer">
            <input
              type="radio"
              name="comunicacion"
              value={value}
              class="hidden peer"
            />
            <svg
              viewBox="0 0 24 24"
              class="w-8 h-8 sm:w-9 sm:h-9
                     text-gray-300
                     hover:text-yellow-400
                     peer-checked:text-yellow-400
                     transition-all duration-200
                     hover:scale-110"
              fill="currentColor"
            >
              <path d="M12 17.27L18.18 21l-1.64-7.03
                       L22 9.24l-7.19-.61L12 2
                       9.19 8.63 2 9.24l5.46 4.73
                       L5.82 21z"/>
            </svg>
          </label>
        ))}
      </div>
    </div>

    {/* ---------- Calidad ---------- */}
    <div>
      <p class="font-medium mb-3">
        {t.quality}
      </p>

      <div class="flex justify-start gap-2">
        {[1,2,3,4,5].map((value) => (
          <label class="cursor-pointer">
            <input
              type="radio"
              name="calidad"
              value={value}
              class="hidden peer"
            />
            <svg
              viewBox="0 0 24 24"
              class="w-8 h-8 sm:w-9 sm:h-9
                     text-gray-300
                     hover:text-yellow-400
                     peer-checked:text-yellow-400
                     transition-all duration-200
                     hover:scale-110"
              fill="currentColor"
            >
              <path d="M12 17.27L18.18 21l-1.64-7.03
                       L22 9.24l-7.19-.61L12 2
                       9.19 8.63 2 9.24l5.46 4.73
                       L5.82 21z"/>
            </svg>
          </label>
        ))}
      </div>
    </div>

    {/* ---------- Ruta ---------- */}
    <div class="sm:col-span-2">
      <p class="font-medium mb-3">
        {t.route}
      </p>

      <div class="flex justify-start gap-2">
        {[1,2,3,4,5].map((value) => (
          <label class="cursor-pointer">
            <input
              type="radio"
              name="ruta"
              value={value}
              class="hidden peer"
            />
            <svg
              viewBox="0 0 24 24"
              class="w-8 h-8 sm:w-9 sm:h-9
                     text-gray-300
                     hover:text-yellow-400
                     peer-checked:text-yellow-400
                     transition-all duration-200
                     hover:scale-110"
              fill="currentColor"
            >
              <path d="M12 17.27L18.18 21l-1.64-7.03
                       L22 9.24l-7.19-.61L12 2
                       9.19 8.63 2 9.24l5.46 4.73
                       L5.82 21z"/>
            </svg>
          </label>
        ))}
      </div>
    </div>

  </div>
</section>
         <!-- üí¨ COMENTARIO P√öBLICO -->
<section class="pt-6 border-t border-gray-200">

  <label class="block font-semibold mb-2 text-lg">
    {t.publicCommentTitle}
  </label>

  <p class="text-sm text-gray-500 mb-4 max-w-xl">
    {t.publicCommentDescription}
  </p>

  <textarea
    name="comentario_publico"
    rows="5"
    required
    minlength="20"
    class="w-full border border-gray-300 rounded-xl px-4 py-3 text-sm
           focus:ring-2 focus:ring-black focus:border-black
           transition-all resize-none"
    placeholder={t.publicCommentPlaceholder}
  ></textarea>

  <p class="text-xs text-gray-400 mt-2">
    {t.minCharacters}
  </p>

</section>

<!-- BOT√ìN ENVIAR -->
<div class="pt-8">

  <button
    type="submit"
    class="w-full bg-black hover:bg-gray-900
           text-white font-semibold
           py-4 rounded-2xl text-lg
           shadow-md transition-all duration-200
           hover:scale-[1.01]"
  >
    {t.submitReview}
  </button>

  <p class="text-center text-xs text-gray-400 mt-4">
    {t.reviewVisibility}
  </p>

</div>
      <script>
  const radios = document.querySelectorAll('input[name="rating_general"]');
  const text = document.getElementById('ratingText');

  const labels = {
    es: {
      1: "Podemos mejorar",
      2: "Buena experiencia",
      3: "Muy buena experiencia",
      4: "Excelente experiencia",
      5: "Experiencia inolvidable ‚≠ê"
    },
    en: {
      1: "We can improve",
      2: "Good experience",
      3: "Very good experience",
      4: "Excellent experience",
      5: "Unforgettable experience ‚≠ê"
    },
    it: {
      1: "Possiamo migliorare",
      2: "Buona esperienza",
      3: "Ottima esperienza",
      4: "Esperienza eccellente",
      5: "Esperienza indimenticabile ‚≠ê"
    },
    fr: {
      1: "Nous pouvons nous am√©liorer",
      2: "Bonne exp√©rience",
      3: "Tr√®s bonne exp√©rience",
      4: "Excellente exp√©rience",
      5: "Exp√©rience inoubliable ‚≠ê"
    }
  };

  const currentLang = document.documentElement.lang || "es";

  radios.forEach(r => {
    r.addEventListener("change", () => {
      text.textContent = labels[currentLang][r.value];
    });
  });
</script>
    </Layout>
  </body>
</html>
