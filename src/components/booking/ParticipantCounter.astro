---
// src/components/booking/ParticipantCounter.astro
interface Props {
  lang?: string;
  showMaxHint?: boolean; // solo Free Tours
}

const { lang = "es", showMaxHint = false } = Astro.props as Props;
---

<div class="participant-counter bg-gray-50 border border-gray-200 rounded-2xl p-5 space-y-5">

  <!-- TÃ­tulo -->
  <div class="flex items-center justify-between">
    <h3 class="font-semibold text-gray-900 text-base">
      {lang === 'es' ? 'ðŸ‘¥ Participantes' :
       lang === 'en' ? 'ðŸ‘¥ Participants' :
       lang === 'it' ? 'ðŸ‘¥ Partecipanti' :
       lang === 'fr' ? 'ðŸ‘¥ Participants' :
       'ðŸ‘¥ Participantes'}
    </h3>

    {showMaxHint && (
  <span class="text-xs text-gray-500">
    {lang === "es"
      ? "MÃ¡x. 7 personas por reserva"
      : lang === "en"
      ? "Max. 7 people per booking"
      : lang === "it"
      ? "Max. 7 persone per prenotazione"
      : lang === "fr"
      ? "Max. 7 personnes par rÃ©servation"
      : "Max. 7"}
  </span>
)}
  </div>

  <!-- Adultos -->
  <div class="flex items-center justify-between">
    <div>
      <div class="font-medium text-gray-800">
        {lang === 'es' ? 'Adultos' :
         lang === 'en' ? 'Adults' :
         lang === 'it' ? 'Adulti' :
         lang === 'fr' ? 'Adultes' :
         'Adultos'}
      </div>
    </div>

    <div class="flex items-center gap-3">
      <button
        type="button"
        id="decreaseAdults"
        class="w-9 h-9 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition disabled:opacity-40"
        disabled
      >
        âˆ’
      </button>

      <span id="adultsCount" class="w-6 text-center font-semibold text-gray-900">
        1
      </span>

      <button
        type="button"
        id="increaseAdults"
        class="w-9 h-9 rounded-full bg-yellow-400 text-gray-900 hover:bg-yellow-500 transition"
      >
        +
      </button>
    </div>
  </div>

  <!-- NiÃ±os -->
  <div class="flex items-center justify-between">
    <div>
      <div class="font-medium text-gray-800">
        {lang === 'es' ? 'NiÃ±os (0â€“12)' :
         lang === 'en' ? 'Children (0â€“12)' :
         lang === 'it' ? 'Bambini (0â€“12)' :
         lang === 'fr' ? 'Enfants (0â€“12)' :
         'NiÃ±os'}
      </div>
    </div>

    <div class="flex items-center gap-3">
      <button
        type="button"
        id="decreaseChildren"
        class="w-9 h-9 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition disabled:opacity-40"
        disabled
      >
        âˆ’
      </button>

      <span id="childrenCount" class="w-6 text-center font-semibold text-gray-900">
        0
      </span>

      <button
        type="button"
        id="increaseChildren"
        class="w-9 h-9 rounded-full bg-yellow-400 text-gray-900 hover:bg-yellow-500 transition"
      >
        +
      </button>
    </div>
  </div>

</div>
<script>
// Estado de participantes seguro (sin pelearte con TS)
const bookingState =
  ((window as any).bookingState ??= {});

const participants =
  (bookingState.participants ??= { adults: 1, children: 0 });

document.addEventListener("DOMContentLoaded", () => {
  const adultsCount = document.getElementById("adultsCount");
  const childrenCount = document.getElementById("childrenCount");

  const decreaseAdults = document.getElementById("decreaseAdults");
  const increaseAdults = document.getElementById("increaseAdults");
  const decreaseChildren = document.getElementById("decreaseChildren");
  const increaseChildren = document.getElementById("increaseChildren");

  // Guard + aliases NO-null (esto es lo que TS sÃ­ respeta en closures)
  if (
    !(adultsCount instanceof HTMLElement) ||
    !(childrenCount instanceof HTMLElement) ||
    !(decreaseAdults instanceof HTMLButtonElement) ||
    !(increaseAdults instanceof HTMLButtonElement) ||
    !(decreaseChildren instanceof HTMLButtonElement) ||
    !(increaseChildren instanceof HTMLButtonElement)
  ) {
    return;
  }

  const adultsEl = adultsCount;
  const childrenEl = childrenCount;
  const decAdultsBtn = decreaseAdults;
  const incAdultsBtn = increaseAdults;
  const decChildrenBtn = decreaseChildren;
  const incChildrenBtn = increaseChildren;

  function updateCounts() {
    const total = participants.adults + participants.children;

    adultsEl.textContent = String(participants.adults);
    childrenEl.textContent = String(participants.children);

    decAdultsBtn.disabled = participants.adults <= 1;
    decChildrenBtn.disabled = participants.children <= 0;

    incAdultsBtn.disabled = total >= 7;
    incChildrenBtn.disabled = total >= 7;

    document.dispatchEvent(new CustomEvent("participantsUpdated"));
  }

  incAdultsBtn.addEventListener("click", () => {
    participants.adults++;
    updateCounts();
  });

  decAdultsBtn.addEventListener("click", () => {
    if (participants.adults > 1) {
      participants.adults--;
      updateCounts();
    }
  });

  incChildrenBtn.addEventListener("click", () => {
    participants.children++;
    updateCounts();
  });

  decChildrenBtn.addEventListener("click", () => {
    if (participants.children > 0) {
      participants.children--;
      updateCounts();
    }
  });

  updateCounts();
});
</script>