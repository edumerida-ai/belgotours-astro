---
import BookingSteps from "./BookingSteps.astro";
import BookingCalendar from "./BookingCalendar.astro";
import ParticipantCounter from "./ParticipantCounter.astro";
// üî• esto genera una URL real en el build (no /src/...)
import bookingFormUrl from "../../scripts/bookingForm.ts?url";


interface Props {
  tour: any;
  lang: string;
}

const { tour, lang } = Astro.props;
const isFreeTour = tour?.pagoLibre === true || tour?.precio === 0;
const isPrivateTour = tour?.tipo_tour === "privado";
const isSpecialTour = tour?.tipo_tour === "especial"; // chocolate & cerveza


const titleByLang: Record<string, string> = {
  es: "Reserva tu experiencia",
  en: "Book your experience",
  it: "Prenota la tua esperienza",
  fr: "R√©servez votre exp√©rience",
  pt: "Reserve sua experi√™ncia",
};

const contactTitleByLang: Record<string, string> = {
  es: "Tus datos de contacto",
  en: "Your contact details",
  it: "I tuoi dati di contatto",
  fr: "Vos coordonn√©es",
  pt: "Seus dados de contato",
};

const confirmTitleByLang: Record<string, string> = {
  es: "Confirma tu reserva",
  en: "Confirm your booking",
  it: "Conferma la prenotazione",
  fr: "Confirmez votre r√©servation",
  pt: "Confirme sua reserva",
};

const bookingSummaryByLang: Record<string, string> = {
  es: "Resumen de tu reserva",
  en: "Booking summary",
  it: "Riepilogo prenotazione",
  fr: "R√©sum√© de la r√©servation",
  pt: "Resumo da reserva",
};

const privacyTextByLang: Record<string, string> = {
  es: "Acepto los t√©rminos y condiciones y la pol√≠tica de privacidad",
  en: "I accept the terms and conditions and privacy policy",
  it: "Accetto i termini e condizioni e la privacy policy",
  fr: "J'accepte les conditions g√©n√©rales et la politique de confidentialit√©",
  pt: "Aceito os termos e condi√ß√µes e a pol√≠tica de privacidade",
};

const marketingTextByLang: Record<string, string> = {
  es: "Quiero recibir informaci√≥n √∫til y recomendaciones de BelgoTours por email o WhatsApp.",
  en: "I want to receive useful information and recommendations from BelgoTours by email or WhatsApp.",
  it: "Desidero ricevere informazioni utili e consigli da BelgoTours via email o WhatsApp.",
  fr: "Je souhaite recevoir des informations utiles et des recommandations de BelgoTours par email ou WhatsApp.",
  pt: "Quero receber informa√ß√µes √∫teis e recomenda√ß√µes da BelgoTours por email ou WhatsApp.",
};

const howHeardLabelByLang: Record<string, string> = {
  es: "¬øC√≥mo nos conociste?",
  en: "How did you hear about us?",
  it: "Come ci hai conosciuto?",
  fr: "Comment nous avez-vous connus ?",
  pt: "Como nos conheceu?",
};

// ‚úÖ Base de la API de Strapi compilada en build (NO se usa import.meta.env en el navegador)
const STRAPI_API_BASE =
  (import.meta.env.PUBLIC_STRAPI_URL || "http://localhost:1337/api").replace(/\/$/, "");
---

<div
  id="bookingForm"
  data-lang={lang}
  data-api={STRAPI_API_BASE}
  class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden"
>
  <!-- CABECERA -->
<div class="bg-white border-b border-gray-200 p-6 md:p-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">

    <!-- T√≠tulo principal -->
    <div>
      <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-1">
        {titleByLang[lang] || titleByLang.es}
      </h2>
      <p class="text-gray-600 text-sm md:text-base line-clamp-2">
        {tour?.titulo}
      </p>
    </div>

    <!-- Badge informativo (duraci√≥n + tipo de tour) -->
    {(tour?.duracion || tour?.precio === 0) && (
      <!-- Badge informativo -->
<div class="flex items-center">
  <div class="inline-flex items-center gap-2 bg-gray-100 text-gray-800 px-4 py-2 rounded-full text-sm font-medium">

    {/* DURACI√ìN */}
    {!isPrivateTour && tour?.duracion && (
      <span>
        {(() => {
          const total = Number(tour.duracion);
          if (Number.isNaN(total)) return "";
          const h = Math.floor(total / 60);
          const m = total % 60;
          if (h && m) return `${h} h ${m} min`;
          if (h) return `${h} h`;
          return `${m} min`;
        })()}
      </span>
    )}

    {!isPrivateTour && tour?.duracion && <span class="opacity-40">‚Ä¢</span>}

    {/* TIPO / PRECIO */}
    <span>
      {isFreeTour && (
        lang === "es"
          ? "Free tour ¬∑ pago libre"
          : lang === "en"
          ? "Free tour ¬∑ pay what you want"
          : lang === "it"
          ? "Free tour ¬∑ offerta libera"
          : "Free tour"
      )}

      {isPrivateTour && tour?.precio && (
        <>
          {lang === "es" && `Desde ${tour.precio} ‚Ç¨ / grupo`}
          {lang === "en" && `From ‚Ç¨${tour.precio} / group`}
          {lang === "it" && `Da ${tour.precio} ‚Ç¨ / gruppo`}
          {lang === "fr" && `√Ä partir de ${tour.precio} ‚Ç¨ / groupe`}
        </>
      )}

      {isSpecialTour && tour?.precio && (
        <>
          {lang === "es" && `${tour.precio} ‚Ç¨ ¬∑ pago al gu√≠a`}
          {lang === "en" && `‚Ç¨${tour.precio} ¬∑ pay the guide`}
          {lang === "it" && `${tour.precio} ‚Ç¨ ¬∑ pagamento alla guida`}
          {lang === "fr" && `${tour.precio} ‚Ç¨ ¬∑ paiement au guide`}
        </>
      )}
    </span>

  </div>
</div>

    )}

  </div>
</div>

  <BookingSteps currentStep={1} lang={lang} />

  <div class="p-5 md:p-7 space-y-8">
    <!-- PASO 1: FECHA / HORARIO / PARTICIPANTES -->
    <div id="step1" class="booking-step active space-y-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-900">
  {lang === "es" && "Selecciona fecha y hora"}
  {lang === "en" && "Select date and time"}
  {lang === "it" && "Seleziona data e orario"}
  {lang === "fr" && "Choisissez date et horaire"}
</h3>
         <!-- üî• Urgencia inteligente -->
         <div id="urgencyBox" class="hidden rounded-xl border border-yellow-300 bg-yellow-50 px-4 py-3 text-sm text-yellow-800">
         <span id="urgencyText"></span>
         </div>

    <p class="text-xs text-gray-500">
  {isFreeTour && (
    lang === "es"
      ? "Solo para enviarte la confirmaci√≥n y detalles del tour."
      : lang === "en"
      ? "Only to send your booking confirmation and details."
      : lang === "it"
      ? "Solo per inviarti conferma e dettagli del tour."
      : "Uniquement pour envoyer la confirmation du tour."
  )}

  {isPrivateTour && (
    lang === "es"
      ? "Te contactaremos para definir fecha y precio."
      : lang === "en"
      ? "We‚Äôll contact you to define date and price."
      : lang === "it"
      ? "Ti contatteremo per definire data e prezzo."
      : "Nous vous contacterons pour d√©finir la date et le prix."
  )}

  {isSpecialTour && (
    lang === "es"
      ? "Recibir√°s confirmaci√≥n inmediata por email."
      : lang === "en"
      ? "You‚Äôll receive instant email confirmation."
      : lang === "it"
      ? "Riceverai conferma immediata via email."
      : "Confirmation imm√©diate par email."
  )}
</p>


      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
        <div class="bg-gray-50 rounded-2xl border border-gray-200 p-4 md:p-5">
          <BookingCalendar tour={tour} lang={lang} />
        </div>

        <div class="bg-gray-50 rounded-2xl border border-gray-200 p-4 md:p-5 space-y-6">
          <ParticipantCounter lang={lang} />

{isFreeTour && (
  <div class="space-y-2">
    <p class="text-xs text-gray-500">
  {lang === "es" && "M√°x. 7 personas por reserva. Si sois m√°s, pod√©is hacer otra reserva con un segundo email."}
  {lang === "en" && "Max. 7 people per booking. If you‚Äôre more, please make a second booking with another email."}
  {lang === "it" && "Massimo 7 persone per prenotazione. Se siete di pi√π, effettuate una seconda prenotazione con un'altra email."}
  {lang === "fr" && "Maximum 7 personnes par r√©servation. Si vous √™tes plus nombreux, effectuez une seconde r√©servation avec un autre email."}
</p>

    <p class="text-sm font-medium text-gray-700">
  {lang === "es" && "La mayor√≠a de viajeros contribuye alrededor de 15 ‚Ç¨ por persona."}
  {lang === "en" && "Most travelers contribute around ‚Ç¨15 per person."}
  {lang === "it" && "La maggior parte dei viaggiatori contribuisce circa 15 ‚Ç¨ a persona."}
  {lang === "fr" && "La plupart des voyageurs contribuent environ 15 ‚Ç¨ par personne."}
</p>
  </div>
)}

        </div>
      </div>
    </div>

<!-- PASO 2: DATOS DEL CLIENTE -->
<div id="step2" class="booking-step hidden space-y-4">
  <h3 class="text-2xl font-bold text-gray-900">
    {contactTitleByLang[lang] || contactTitleByLang.es}
  </h3>

  <div class="bg-white border border-gray-200 rounded-xl p-3 text-sm text-gray-700 space-y-1">
  <div class="flex justify-between">
    <span>{lang === "es" ? "Fecha" : "Date"}</span>
    <span class="font-semibold" id="step2SummaryDate">--</span>
  </div>
  <div class="flex justify-between">
    <span>{lang === "es" ? "Hora" : "Time"}</span>
    <span class="font-semibold" id="step2SummaryTime">--</span>
  </div>
  <div class="flex justify-between">
    <span>{lang === "es" ? "Personas" : "People"}</span>
    <span class="font-semibold" id="step2SummaryParticipants">--</span>
  </div>
</div>

    <p class="text-xs text-gray-500">
    {lang === "es" && "Solo usaremos tus datos para enviarte la confirmaci√≥n del tour."}
    {lang === "en" && "We‚Äôll only use your data to send your tour confirmation."}
    {lang === "it" && "Useremo i tuoi dati solo per inviarti la conferma del tour."}
    {lang === "fr" && "Nous utiliserons vos donn√©es uniquement pour vous envoyer la confirmation."}
   </p>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Nombre -->
    <div>
      <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">
        {lang === "es" && "Nombre"}
        {lang === "en" && "First name"}
        {lang === "it" && "Nome"}
        {lang === "fr" && "Pr√©nom"} *
      </label>
      <input
        id="firstName"
        name="firstName"
        type="text"
        required
        class="w-full p-2.5 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition placeholder-gray-400"
        placeholder={lang === "es" ? "Ej: Mar√≠a" : "John"}
      />
    </div>

    <!-- Apellidos -->
    <div>
      <label for="lastName" class="block text-gray-700 font-medium mb-1 text-sm">
        {lang === "es" && "Apellidos"}
        {lang === "en" && "Last name"}
        {lang === "it" && "Cognome"}
        {lang === "fr" && "Nom de famille"} *
      </label>
      <input
        id="lastName"
        name="lastName"
        type="text"
        required
        class="w-full p-2.5 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition placeholder-gray-400"
        placeholder={lang === "es" ? "Ej: Gonz√°lez L√≥pez" : "Doe"}
      />
    </div>

    <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
  <!-- Ciudad -->
  <div>
    <label for="customerCity" class="block text-gray-700 font-medium mb-1 text-sm">
      üèôÔ∏è
      {lang === "es" && "Ciudad"}
      {lang === "en" && "City"}
      {lang === "it" && "Citt√†"}
      {lang === "fr" && "Ville"} *
    </label>
    <div class="relative">
  <input
    id="customerCity"
    name="customerCity"
    type="text"
    required
    autocomplete="off"
    class="w-full p-3 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition"
    placeholder="Madrid, Brussels, Rome..."
  />
  <div id="citySuggestions"
       class="absolute z-20 bg-white border border-gray-200 rounded-xl shadow-lg w-full mt-1 hidden max-h-48 overflow-y-auto text-sm">
  </div>
</div>
  </div>

  <!-- Pa√≠s -->
  <div>
    <label for="customerCountry" class="block text-gray-700 font-medium mb-1 text-sm">
      üåç
      {lang === "es" && "Pa√≠s"}
      {lang === "en" && "Country"}
      {lang === "it" && "Paese"}
      {lang === "fr" && "Pays"} *
    </label>
    <div class="relative">
  <input
    id="customerCountry"
    name="customerCountry"
    type="text"
    required
    autocomplete="off"
    class="w-full p-3 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition"
    placeholder="Espa√±a, M√©xico, Italia..."
  />
  <div id="countrySuggestions"
       class="absolute z-20 bg-white border border-gray-200 rounded-xl shadow-lg w-full mt-1 hidden max-h-48 overflow-y-auto text-sm">
  </div>
</div>
  </div>
</div>

    <!-- Tel√©fono (Intl Tel Input profesional) -->
<div class="md:col-span-2">
  <label class="block text-sm font-medium text-gray-700 mb-1">
    üì±
    {lang === "es" && "M√≥vil (WhatsApp recomendado)"}
    {lang === "en" && "Mobile phone (WhatsApp recommended)"}
    {lang === "it" && "Cellulare (WhatsApp consigliato)"}
    {lang === "fr" && "T√©l√©phone portable (WhatsApp recommand√©)"} *
  </label>

  <div class="relative">
    <input
      id="customerPhone"
      name="customerPhone"
      type="tel"
      required
      inputmode="tel"
      autocomplete="tel"
      class="w-full p-3 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition"
      placeholder="+34 612 345 678"
    />

    <!-- Mensaje error tel√©fono -->
    <p
      id="phoneError"
      class="text-xs text-red-500 mt-1 hidden"
    >
      {lang === "es" && "Introduce un n√∫mero v√°lido"}
      {lang === "en" && "Please enter a valid phone number"}
      {lang === "it" && "Inserisci un numero valido"}
      {lang === "fr" && "Veuillez entrer un num√©ro valide"}
    </p>
  </div>
</div>

    <!-- Email -->
    <div>
      <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-1">
        üìß
        {lang === "es" && "Correo electr√≥nico"}
        {lang === "en" && "Email address"}
        {lang === "it" && "Indirizzo email"}
        {lang === "fr" && "Adresse email"} *
      </label>
      <input
        id="customerEmail"
        name="customerEmail"
        type="email"
        required
        class="w-full p-2.5 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition placeholder-gray-400"
        placeholder="email@ejemplo.com"
      />
    </div>

    <!-- Confirmar Email -->
    <div>
      <label for="customerEmailConfirm" class="block text-sm font-medium text-gray-700 mb-1">
        ‚úÖ
        {lang === "es" && "Confirma tu correo"}
        {lang === "en" && "Confirm your email"}
        {lang === "it" && "Conferma la tua email"}
        {lang === "fr" && "Confirmez votre email"} *
      </label>
      <input
        id="customerEmailConfirm"
        name="customerEmailConfirm"
        type="email"
        required
        class="w-full p-2.5 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition placeholder-gray-400"
        placeholder={lang === "es" ? "Repite tu correo" : "Repeat your email"}
      />
      <p id="emailMismatch" class="text-xs text-red-500 mt-1 hidden">
        {lang === "es" && "Los correos no coinciden."}
        {lang === "en" && "Emails do not match."}
      </p>
    </div>

    <!-- Comentarios -->
    <div class="md:col-span-2">
      <label for="customerComments" class="block text-sm font-medium text-gray-700 mb-1">
        üí¨
        {lang === "es" && "Comentarios (opcional)"}
        {lang === "en" && "Comments (optional)"}
        {lang === "it" && "Commenti (opzionale)"}
        {lang === "fr" && "Commentaires (optionnel)"}
      </label>
      <textarea
        id="customerComments"
        name="customerComments"
        rows="3"
        class="w-full p-2.5 border border-gray-300 rounded-xl focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none transition placeholder-gray-400"
        placeholder={
          lang === "es"
            ? "Ej: viajamos con ni√±os peque√±os, silla de ruedas, etc."
            : "Anything we should know?"
        }
      ></textarea>
    </div>

    <!-- Como nos conociste -->
    <div>
      <label for="howHeard" class="block text-sm font-medium text-gray-700 mb-1">
        {howHeardLabelByLang[lang] || howHeardLabelByLang.es}
      </label>
      <select
        id="howHeard"
        name="howHeard"
        class="w-full p-2.5 border border-gray-300 rounded-xl bg-white focus:border-gray-900 focus:ring-2 focus:ring-yellow-300 focus:outline-none text-sm"
      >
        <option value="">{lang === "es" ? "Selecciona una opci√≥n" : "Select an option"}</option>
        <option value="google">Web / Google</option>
        <option value="flyer">Flyer</option>
        <option value="instagram">Instagram</option>
        <option value="facebook">Facebook</option>
        <option value="youtube">YouTube</option>
        <option value="friends">Amigos / Familia</option>
        <option value="guruwalk">GuruWalk</option>
        <option value="civitatis">Civitatis</option>
        <option value="tripadvisor">TripAdvisor</option>
        <option value="getyourguide">GetYourGuide</option>
        <option value="freetour">FreeTour.com</option>
        <option value="meeting-point">Punto de encuentro</option>
        <option value="other">Otro</option>
      </select>
    </div>

    <!-- Marketing -->
    <div class="flex items-start gap-3 md:col-span-2">
      <input
        id="marketingConsent"
        name="marketingConsent"
        type="checkbox"
        class="mt-1 accent-gray-900"
      />
      <span class="text-sm text-gray-700">
        {marketingTextByLang[lang] || marketingTextByLang.es}
      </span>
    </div>
  </div>
</div>

<!-- PASO 3: RESUMEN + T√âRMINOS -->
    <div id="step3" class="booking-step hidden space-y-6">
      <h3 class="text-2xl font-bold text-gray-900">
        ‚úÖ {confirmTitleByLang[lang] || confirmTitleByLang.es}
      </h3>

      <div class="bg-gray-50 rounded-2xl border-2 border-gray-200 p-6 space-y-4">
        <h4 class="font-semibold text-lg text-gray-800">
          {bookingSummaryByLang[lang] || bookingSummaryByLang.es}
        </h4>
        <div class="space-y-3 text-gray-700 text-sm">
          <div class="flex justify-between">
            <span>Tour</span>
            <span class="font-semibold text-right max-w-[60%]">
              {tour?.titulo}
            </span>
          </div>
          <div class="flex justify-between">
            <span>{lang === "es" ? "Fecha" : "Date"}</span>
            <span class="font-semibold" id="summaryDate">--/--/----</span>
          </div>
          <div class="flex justify-between">
            <span>{lang === "es" ? "Horario" : "Time"}</span>
            <span class="font-semibold" id="summaryTime">--:--</span>
          </div>
          <div class="flex justify-between">
            <span>
              {lang === "es" ? "Participantes" : "Participants"}
            </span>
            <span class="font-semibold" id="summaryParticipants">--</span>
          </div>
          <div class="flex justify-between">
            <span>{lang === "es" ? "Idioma" : "Language"}</span>
            <span class="font-semibold uppercase">{lang}</span>
          </div>
          
        </div>
      </div>

      <div class="space-y-4">
        <label class="flex items-start gap-3 cursor-pointer">
          <input
            type="checkbox"
            id="agreeToTerms"
            name="agreeToTerms"
            required
            class="mt-1 text-blue-600 focus:ring-blue-500 rounded"
          />
          <span class="text-sm text-gray-700">
            {privacyTextByLang[lang] || privacyTextByLang.es} *
          </span>
        </label>

        <p class="text-xs text-gray-500">
          {lang === "es" &&
            "Al confirmar, recibir√°s un email autom√°tico con todos los detalles y un mensaje preparado para compartir por WhatsApp."}
          {lang === "en" &&
            "After confirming, you will receive an automatic email with all details and a pre-filled message to share on WhatsApp."}
        </p>
      </div>

      <!-- CONFIRMAR RESERVA / SOLICITUD -->
<button
  id="confirmBooking"
  type="button"
  class="w-full bg-yellow-400 hover:bg-yellow-300 text-gray-900 font-extrabold py-4 px-8 rounded-xl transition duration-300 transform hover:scale-105 shadow-lg disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed disabled:transform-none"
  disabled
>
  {isPrivateTour && (
    <>
      {lang === "es" && "üì© Enviar solicitud"}
      {lang === "en" && "üì© Send request"}
      {lang === "it" && "üì© Invia richiesta"}
      {lang === "fr" && "üì© Envoyer la demande"}
      {!["es", "en", "it", "fr"].includes(lang) && "üì© Send request"}
    </>
  )}

  {!isPrivateTour && (
    <>
      {lang === "es" && "‚úÖ Confirmar reserva"}
      {lang === "en" && "‚úÖ Confirm booking"}
      {lang === "it" && "‚úÖ Conferma prenotazione"}
      {lang === "fr" && "‚úÖ Confirmer la r√©servation"}
      {!["es", "en", "it", "fr"].includes(lang) && "‚úÖ Confirm booking"}
    </>
  )}
</button>
<p class="text-xs text-gray-500 text-center mt-3">
  {isFreeTour && (
    <>
      {lang === "es" && "Reserva gratuita. Cancelaci√≥n sin coste. Confirmaci√≥n inmediata por email."}
      {lang === "en" && "Free booking. Free cancellation. Instant email confirmation."}
      {lang === "it" && "Prenotazione gratuita. Cancellazione gratuita. Conferma immediata via email."}
      {lang === "fr" && "R√©servation gratuite. Annulation gratuite. Confirmation imm√©diate par email."}
    </>
  )}

  {isPrivateTour && (
    <>
      {lang === "es" && "Sin pago ahora. Te contactaremos para definir fecha y precio final."}
      {lang === "en" && "No payment now. We will contact you to define final date and price."}
      {lang === "it" && "Nessun pagamento ora. Ti contatteremo per definire data e prezzo finale."}
      {lang === "fr" && "Aucun paiement maintenant. Nous vous contacterons pour d√©finir la date et le prix final."}
    </>
  )}

  {isSpecialTour && (
    <>
      {lang === "es" && "Pago directo al gu√≠a el d√≠a del tour."}
      {lang === "en" && "Pay the guide directly on the day of the tour."}
      {lang === "it" && "Pagamento diretto alla guida il giorno del tour."}
      {lang === "fr" && "Paiement directement au guide le jour du tour."}
    </>
  )}
</p>

</div>

<!-- VISTA DE √âXITO (fallback si no redirigimos) -->
<div id="bookingSuccess" class="hidden space-y-4 text-center py-10">

  <!-- T√çTULO -->
  <h3 class="text-2xl md:text-3xl font-bold text-green-600 mb-2">
    {isPrivateTour && (
      <>
        {lang === "es" && "‚úÖ Solicitud confirmada"}
        {lang === "en" && "‚úÖ Request confirmed"}
        {lang === "it" && "‚úÖ Richiesta confermata"}
        {lang === "fr" && "‚úÖ Demande confirm√©e"}
        {!["es", "en", "it", "fr"].includes(lang) && "‚úÖ Request confirmed"}
      </>
    )}

    {!isPrivateTour && (
      <>
        {lang === "es" && "üéâ ¬°Reserva confirmada!"}
        {lang === "en" && "üéâ Booking confirmed!"}
        {lang === "it" && "üéâ Prenotazione confermata!"}
        {lang === "fr" && "üéâ R√©servation confirm√©e !"}
        {!["es", "en", "it", "fr"].includes(lang) && "üéâ Booking confirmed!"}
      </>
    )}
  </h3>

  <!-- TEXTO -->
  <p class="text-gray-700 text-sm md:text-base max-w-xl mx-auto">
    {isPrivateTour && (
      <>
        {lang === "es" &&
          "Hemos recibido tu solicitud. Te contactaremos por email o WhatsApp para definir el itinerario, la fecha final y el precio del tour privado."}
        {lang === "en" &&
          "We‚Äôve received your request. We‚Äôll contact you by email or WhatsApp to define the itinerary, final date and price of your private tour."}
        {lang === "it" &&
          "Abbiamo ricevuto la tua richiesta. Ti contatteremo via email o WhatsApp per definire itinerario, data finale e prezzo del tour privato."}
        {lang === "fr" &&
          "Nous avons re√ßu votre demande. Nous vous contacterons par email ou WhatsApp pour d√©finir l‚Äôitin√©raire, la date finale et le prix du tour priv√©."}
        {!["es", "en", "it", "fr"].includes(lang) &&
          "We‚Äôve received your request and will contact you shortly."}
      </>
    )}

    {!isPrivateTour && (
      <>
        {lang === "es" &&
          "Te hemos enviado un email con todos los detalles del tour. Si no lo ves en unos minutos, revisa tu carpeta de spam o promociones."}
        {lang === "en" &&
          "We have sent you an email with all the tour details. If you don't see it in a few minutes, please check your spam or promotions folder."}
        {lang === "it" &&
          "Ti abbiamo inviato un‚Äôemail con tutti i dettagli del tour. Se non la vedi, controlla la cartella spam o promozioni."}
        {lang === "fr" &&
          "Nous vous avons envoy√© un email avec tous les d√©tails du tour. Pensez √† v√©rifier votre dossier spam ou promotions."}
        {!["es", "en", "it", "fr"].includes(lang) &&
          "We have sent you an email with the tour details."}
      </>
    )}
  </p>

  <!-- BOT√ìN SECUNDARIO -->
  <button
    id="newBooking"
    type="button"
    class="mt-4 inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-gray-800 font-semibold rounded-xl hover:bg-gray-100 transition"
  >
    {isPrivateTour && lang === "es" && "Volver a BelgoTours"}
    {isPrivateTour && lang === "en" && "Back to BelgoTours"}
    {isPrivateTour && lang === "it" && "Torna a BelgoTours"}
    {isPrivateTour && lang === "fr" && "Retour √† BelgoTours"}

    {!isPrivateTour && lang === "es" && "Hacer otra reserva"}
    {!isPrivateTour && lang === "en" && "Make another booking"}
    {!isPrivateTour && lang === "it" && "Fai un'altra prenotazione"}
    {!isPrivateTour && lang === "fr" && "Faire une autre r√©servation"}
  </button>

</div>

<!-- NAVEGACI√ìN -->
<div
  id="bookingNav"
  class="flex justify-between mt-4 pt-4 border-t border-gray-200"
>
  <button
    id="prevStep"
    type="button"
    class="px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed"
    disabled
  >
    {lang === "es" && "‚Üê Anterior"}
    {lang === "en" && "‚Üê Previous"}
    {lang === "it" && "‚Üê Precedente"}
    {lang === "fr" && "‚Üê Pr√©c√©dent"}
    {!["es", "en", "it", "fr"].includes(lang) &&
      "‚Üê Previous"}
  </button>

  <!-- SIGUIENTE (FLUJO) -->
  <button
    id="nextStep"
    type="button"
    class="px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white font-semibold rounded-xl transition transform hover:scale-105 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed disabled:transform-none"
    disabled
  >
    {lang === "es" && "Siguiente ‚Üí"}
    {lang === "en" && "Next ‚Üí"}
    {lang === "it" && "Successivo ‚Üí"}
    {lang === "fr" && "Suivant ‚Üí"}
    {!["es", "en", "it", "fr"].includes(lang) && "Next ‚Üí"}
  </button>
</div>

  </div>
</div>

  </div>
</div>

<style>
  .booking-step {
    display: none;
  }
  .booking-step.active {
    display: block;
  }
  .booking-step.hidden {
    display: none;
  }

  @media (max-width: 768px) {
  #bookingNav {
    position: sticky;
    bottom: 0;
    background: white;
    padding-bottom: 10px;
  }
}



</style>
<script type="module" src={bookingFormUrl}></script>